?extract
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
x
#ifelse(length(x) < 3, y$Sample.ID,
#       sapply(x, "[[",1:3))
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#paste(c(x[[1]], x[[2]], x[[3]]), sep = "_")
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
x
ifelse(length(x) < 3, y$Sample.ID,
paste(x[1:3], sep = "_"))
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
x
ifelse(length(x) < 3, y$Sample.ID,
paste(x[2:3], sep = "_"))
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
x
ifelse(length(x) < 3, y$Sample.ID,
paste(c(x[1], x[2], x[3]), sep = "_"))
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
ifelse(length(x) < 3, y$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, y$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
unlist(nms)
})
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
lapply(meta_files_data, function(y) {
first_names <- lapply(str_split(y$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, y$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
y$Sample.ID2 <- unlist(first_names)
#broken <- y %>% dplyr::group_by(Sample.ID) %>% tidyr::nest()
#
})
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, y$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, y$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, metadata$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, metadata$Sample.ID,
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
View(meta_files_data[[1]])
View(meta_files_data[[2]])
test <- meta_files_data[[1]] %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
test2 <- meta_files_data[[2]] %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
View(test)
test
test2
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
View(meta_files_data[[1]])
test <- meta_files_data[[1]] %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
test2 <- meta_files_data[[2]] %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
test
test2
test2$data[[1]]
test2$data[[1]][, c("Dilution.Factor", "Status")]
test2$data[[1]][, c("Sample.ID", "Dilution.Factor", "Status")]
names(test2$data[[1]])
metafiles <- list.dirs("../Cytometer Data")
metafiles
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
meta_files_data[[1]]
View(meta_files_data[[1]])
View(meta_files_data[[4]])
metafiles
View(meta_files_data[[1]])
test2$data[[1]][, c("Sample.ID2", "Dilution.Factor", "Status")]
test2$data[[1]][, c("Sample.ID", "Dilution.Factor", "Status")]
source("../../cyanoFilter/R/retain.R")
lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
broken$Retain <- purrr::map(broken$data, function(.x) {
.x %>% retain(., make_decision = "mini")
})
})
source("../../cyanoFilter/R/good_measurement.R")
source("../../cyanoFilter/R/retain.R")
metafiles <- list.dirs("../Cytometer Data")
#reading in all meta data file and determining their status
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
rm(test, test2)
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
broken$Retain <- purrr::map(broken$data, function(.x) {
.x %>% retain(., make_decision = "mini")
})
return(broken)
})
test[[1]]
test[[1]]$Retain
test[[1]]$Sample.ID2
test[[2]]$Retain
metafiles
test[[3]]$Retain
test[[3]]$Sample.ID2
View(test[[2]])
View(meta_files_data[[1]])
View(meta_files_data[[2]])
View(meta_files_data[[3]])
View(meta_files_data[[3]])
View(test[[3]])
test[[3]]$data[23,]
View(test[[3]]$data[[23]])
source("../../cyanoFilter/R/retain.R")
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
broken$Retain <- purrr::map(broken$data, function(.x) {
.x %>% retain(., make_decision = "mini")
})
return(broken)
})
View(test[[3]])
View(test[[1]])
View(test[[2]])
View(test[[4]])
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
broken$Retain <- purrr::map(broken$data, function(.x) {
.x %>% retain(., make_decision = "mini")
})
return(tidyr::unnest(broken))
})
View(test[[2]])
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
broken %>% dplyr::mutate(Retains = purrr::map(broken$data, function(.x) {
.rt <- .x %>% retain(., make_decision = "mini")
cbind(.x, Retain = .rt)
})
)
return(broken)
})
View(test[[2]])
View(test[[2]]$data[[1]])
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
brokenR <- broken %>% dplyr::mutate(Retains = purrr::map(broken$data, function(.x) {
rt <- .x %>% retain(., make_decision = "mini")
cbind(.x, Retain = rt)
})
)
return(brokenR)
})
View(test[[2]]$data[[1]])
View(test[[2]])
View(test[[2]]$Retains[[1]])
View(test[[1]]$Retains[[1]])
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
brokenR <- broken %>% dplyr::mutate(Retains = purrr::map(broken$data, function(.x) {
rt <- .x %>% retain(., make_decision = "mini")
cbind(.x, Retain = rt)
})
)
return(tidyr::unnest(brokenR))
})
View(test[[1]])
warnings()[1:4]
library(flowCore)
library(flowDensity)
library(flowDensity)
library(tidyverse)
library(stringr)
source("../../cyanoFilter/R/good_measurement.R")
source("../../cyanoFilter/R/retain.R")
source("../../cyanoFilter/R/lnTrans.R")
source("../../cyanoFilter/R/nona.R")
source("../../cyanoFilter/R/noneg.R")
source("../../cyanoFilter/R/plotting_functions.R")
#source("../../cyanoFilter/R/cell_debris.R")
#source("../../cyanoFilter/R/cell_debris_nc.R")
source("../../cyanoFilter/R/debris_nc.R")
source("../../cyanoFilter/R/debris_c.R")
source("../../cyanoFilter/R/bs4_nc.R")
source("../../cyanoFilter/R/bs4_c.R")
source("../../cyanoFilter/R/debris_invasion_nc.R")
source("../../cyanoFilter/R/bs4_invasion_c.R")
source("../../cyanoFilter/R/bs5_c.R")
source("../../cyanoFilter/R/bs5_nc.R")
source("../../cyanoFilter/R/bs5_invasion_c.R")
source("../../cyanoFilter/R/bs5_invasion_nc.R")
source("../../cyanoFilter/R/Margin_Cells.R")
#list all folders in the Cytometer Data folder
metafiles <- list.dirs("../Cytometer Data")
#reading in all meta data file and determining their status
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
test <- lapply(meta_files_data, function(y) {
broken <- y %>% dplyr::group_by(Sample.ID2) %>% tidyr::nest()
brokenR <- broken %>% dplyr::mutate(Retains = purrr::map(broken$data, function(.x) {
rt <- .x %>% retain(., make_decision = "mini")
cbind(.x, Retain = rt)
})
)
return(tidyr::unnest(brokenR))
})
View(test[[1]])
View(meta_files_data[[1]])
View(meta_files_data[[2]])
View(meta_files_data[[3]])
View(test[[3]])
length(unique(test[[1]]$Sample.Number))
length(unique(test[[3]]$Sample.Number))
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
metadata$File <- csv.toberead
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, read.csv, skip = 7,
stringsAsFactors = F,
check.names = T)
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
View(meta_files_data[[2]])
meta_files_data <- lapply(metafiles[2:length(metafiles)], function(x) {
inside <- list.files(x, full.names = T)
csv.ext <- which(tools::file_ext(inside) == "csv" &
!str_detect(inside, "GroupStats"))
csv.toberead <- inside[csv.ext]
if(length(csv.ext) == 1) {
metadata <- read.csv(csv.toberead, skip = 7,
stringsAsFactors = F,
check.names = T)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
metadata$File <- csv.toberead
} else if (length(csv.ext) > 1) {
metadatas <- lapply(csv.toberead, function(x) {
ddata <- read.csv(x, skip = 7, stringsAsFactors = F, check.names = T)
ddata$File <- x
return(ddata)
})
metadata <- do.call(rbind.data.frame, metadatas)
names(metadata)[which(str_detect(names(metadata), "Cells."))] <- "CellspML"
first_names <- sapply(str_split(metadata$Sample.ID, "_"), "[[", 1)
metadata$Strain <- str_extract(first_names, "[4-5]")
metadata$Status <- goodfcs(metadata, mxd_cellpML = 1000, mnd_cellpML = 50)
id_names <- lapply(str_split(metadata$Sample.ID, "_"), function(x) {
nms <- ifelse(length(x) < 3, paste(x[1], x[2], sep = "_"),
paste(x[1], x[2], x[3], sep = "_"))
})
metadata$Sample.ID2 <- unlist(id_names)
}
return(metadata)
})
View(meta_files_data[[1]])
View(meta_files_data[[3]])
View(meta_files_data[[4]])
library(flowDensity)
install.packages("maps")
library(maps)
install.packages("maps")
